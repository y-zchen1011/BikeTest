<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZQJGH8PK8W"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-ZQJGH8PK8W');
    </script>
    <meta charset="UTF-8">
    <title>Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="Plugin_bootstrap/css/bootstrap.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@1,300&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="Plugin_fontawesome/css/all.css" rel="stylesheet">
    <link href="CSS/main.css" rel="stylesheet">

    <script src="js/jquery-3.5.0.js"></script>

</head>

<body>

<header class="bg-dark py-1">
    <div class="container">
        <h1 class="logo"><a href="https://cieeberlin.org">CIEE</a></h1>
    </div>
</header>

<section id="success" class="container mx-auto text-center">
    <h1 id="msg_title" class="mt-5 text-primary"></h1>
    <h2 class="my-3">Your score : <span class="ipscore my-3 text-danger" id="resultsc"></span></h2>
    <p id="msg_content" class="mt-3"></p>
    <div class="text-right mr-5">
        <input id="startAgain" class="btn-lg btn_startAgain btn-primary rounded-lg text-white py-2 px-4 mr-5"
               type="button"
               name="submit" value="Start again">
    </div>
</section>

<section id="answerReview" class="container bg-light mx-auto text-center ">
    <div class="d-flex justify-content-around align-items-center">
        <h3 class="">Review</h3>
        <button class="btn btn-primary" id="expand">Expand/Collapse</button>
    </div>
    <div id="wrapper" class="open bg-light table-responsive">
        <table id="testReview" class="table">
            <thead>
                <tr>
                    <th scope="col">1</th>
                    <th scope="col">2</th>
                    <th scope="col">3</th>
                    <th scope="col">4</th>
                    <th scope="col">5</th>
                    <th scope="col">6</th>
                    <th scope="col">7</th>
                    <th scope="col">8</th>
                    <th scope="col">9</th>
                    <th scope="col">10</th>
                    <th scope="col">11</th>
                    <th scope="col">12</th>
                </tr>
            </thead>
            <tbody>
                <tr id="reviewTable">
                </tr>
            </tbody>
        </table>
    </div>
</section>

<section id="registerForm" class="mt-5 bg-light">
    <div class="container">
        <div class="Regis_holder">
            <h1 class="text-center mx-auto mb-3 pl-2 pt-2">Registration</h1>
            <form>
                <div class="form-row align-items-center mx-auto">
                    <div class="col-md-8 mx-auto mb-2">
                        <label class="sr-only" for="inlineFormInputfirstName">Username</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">First name</div>
                            </div>
                            <input type="text" class="form-control" id="inlineFormInputfirstName" required>
                        </div>
                    </div>
                    <div class="col-md-8 mx-auto mb-2">
                        <label class="sr-only" for="inlineFormInputlastName">Username</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">Last name</div>
                            </div>
                            <input type="text" class="form-control" id="inlineFormInputlastName" required>
                        </div>
                    </div>
                    <div class="col-md-8 mx-auto mb-2">
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">Email</div>
                            </div>
                            <input type="email" class="form-control" id="inlineFormInputemail" required>
                        </div>
                    </div>
                    <div class="col-md-8 mx-auto mb-2">
                        <label class="sr-only" for="inlineFormInputroomnr">Username</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">Room number</div>
                            </div>
                            <input type="text" class="form-control" id="inlineFormInputroomnr" required>
                        </div>
                    </div>
                    <div class="col-md-8 mx-auto mb-2">
                        <label class="mr-sm-2 sr-only" for="inlineFormCustomSelect">Preference</label>
                        <select class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                            <option selected disabled>Your Stay</option>
                            <option value="1">Till end of Block I</option>
                            <option value="2">Till end of Block II</option>
                            <option value="3">Till end of Block III</option>
                        </select>
                    </div>

                    <div class="col-md-8 form-group mx-auto">
                        <div class="form-check  mt-4 text-justify">
                            <input class="form-check-input " type="radio" name="qa1" id="gridRadios1" value="option1"
                                   checked>
                            <label class="form-check-label font-weight-bolder ml-2" for="gridRadios1">
                                I have entered a valid email address which I can always receive mails from Student Life
                                Office while checking-in/out a bike.
                                <br>
                                <p class="mt-2">I agree to the terms and conditions<span
                                        style="color: red;vertical-align: top">*</span></p>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-8 form-group mx-auto">
                        <div class="form-check   mt-4 text-justify">
                            <input class="form-check-input" type="radio" name="qa2" id="gridRadios2" value="option2"
                                   checked>
                            <label class="form-check-label font-weight-bolder ml-2" for="gridRadios2">
                                I agree that I would notify the Student Life Office by email or in-person if not getting
                                a confirmation E-mail within 24 hours (except for weekends) once I successfully
                                check-in/out a bike.
                                <br>
                                <p class="mt-2">I agree to the terms and conditions<span
                                        style="color: red;vertical-align: top">*</span></p>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-8 form-group mx-auto">
                        <div class="form-check   mt-4 text-justify">
                            <input class="form-check-input" type="radio" name="qa3" id="gridRadios3" value="option3"
                                   checked>
                            <label class="form-check-label font-weight-bolder ml-2" for="gridRadios3">
                                I acknowledge that it is my responsibility to reach out to the Student Life Office if a
                                rental confirmation email was sent to my own email by any mistake since the rental would
                                be under my name.
                                <br>
                                <p class="mt-2">I agree to the terms and conditions<span
                                        style="color: #ff0000;vertical-align: top">*</span></p>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-8 my-4 mx-auto d-flex justify-content-end">
                        <button type="submit" class="btn_formSubmit btn-lg btn-primary mb-2 px-5" id="formSubmit">Submit
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</section>

<footer class="bg-dark">
    <div class="container d-flex justify-content-center flex-column align-items-center">
        <p class="text-white pt-4">If you need any support</p>
        <p class="text-white">Email : <a href="mailto:cieeberlinstudentlife@gmail.com" class="text-white">cieeberlinstudentlife@gmail.com</a>
        </p>
        <p class="text-white">or just come by the reception</p>
    </div>
</footer>

</body>


<script src="js/form.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js">
</script>

<script>
    $(function() {
        var b = $("#expand");
        var w = $("#wrapper");
        var l = $("#testReview");

        w.height(l.outerHeight(true));

        b.click(function(e) {
            e.preventDefault();
            if(w.hasClass('open')) {
                w.removeClass('open');
                w.height(0);
            } else {
                w.addClass('open');
                w.height(l.outerHeight(true));
            }

        });
    });
</script>


<script>
    (function () {
        emailjs.init("user_bLcS7SbZdTLTMgGDlu4HP");
    })();
</script>

<script>
    let config = {
        apiKey: "AIzaSyBgNHmBw53QL51_4J-JP54PyWEF7fR-NUk",
        authDomain: "https://cieebikeservice.firebaseio.com/",
        databaseURL: "https://cieebikeservice.firebaseio.com/",
        storageBucket: "cieebikeservice.appspot.com",
        projectId: "cieebikeservice",
    };
    firebase.initializeApp(config);
    let msgRef = firebase.database();
    const formSubmit = document.querySelector('#formSubmit');
    formSubmit.addEventListener('click', function (e) {
        let firstName = document.querySelector('#inlineFormInputfirstName').value.trim();
        let lastName = document.querySelector('#inlineFormInputlastName').value.trim();
        let roomNr = document.querySelector('#inlineFormInputroomnr').value.trim();
        let email = document.querySelector('#inlineFormInputemail').value.trim();
        let stay = document.querySelector('#inlineFormCustomSelect').value;
        let q1 = document.querySelector('#gridRadios1').value;
        let q2 = document.querySelector('#gridRadios2').value;
        let q3 = document.querySelector('#gridRadios3').value;
        e.preventDefault();
        if (firstName === "" || lastName === "" || roomNr === "" || email === "" ||
            stay === "Your Stay" || q1 === "" || q2 === "" || q3 === "") {
            alert('Please fill in all fields');
        } else {
            firstName = initCapital(firstName);
            lastName = initCapital(lastName);
            if (ValidateEmail(email)) {
                axios.post("https://cieebikeapi.herokuapp.com/api/member",{
                    firstname: firstName,
                    lastname: lastName,
                    roomnumber: roomNr,
                    emailaddress: email,
                    stay: stay,
                }).then(()=>{
                    let templateParams = {
                        title: 'Welcome letter',
                        msg: 'You can now go to the reception and rent out your bike!',
                        Name: firstName,
                        mailadress: email
                    };

                    (function sendMail() {
                        emailjs.send('service_3dk0adg', 'template_k6y7q2b', templateParams)
                            .then(function (response) {
                                console.log('SUCCESS!', response.status, response.text);
                            }, function (error) {
                                console.log('FAILED...', error);
                            });
                    })();
                }).catch(function () {
                    alert('Error, please try again');
                });
                /*msgRef.ref('/Member/' + firstName + '_' + lastName).set({
                    firstname: firstName,
                    lastname: lastName,
                    roomnumber: roomNr,
                    emailaddress: email,
                    stay: stay,
                    hasbike: false,
                    bikeout: "",
                })
                    .then(msgRef.ref('/Member/').once('child_added', function () {
                        let templateParams = {
                            title: 'Welcome letter',
                            msg: 'You can now go to the reception and rent out your bike!',
                            Name: firstName,
                            mailadress: email
                        };

                        (function sendMail() {
                            emailjs.send('service_3dk0adg', 'template_k6y7q2b', templateParams)
                                .then(function (response) {
                                    console.log('SUCCESS!', response.status, response.text);
                                }, function (error) {
                                    console.log('FAILED...', error);
                                });
                        })();

                        alert('success!');
                        window.location.href = 'EndPage.html';
                    }))
                    .catch(function () {
                        alert('Error, please try again');
                    });*/
            } else {
                alert("You have entered an invalid email address!");
            }
        }
    }, false);

    function initCapital(str) {
        var strarr = str.split(' ');
        var result = '';
        for (var i in strarr) {
            result = strarr[i].substring(0, 1).toUpperCase() + strarr[i].substring(1);
        }
        return result;
    }

    function ValidateEmail(email) {
        if (/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(email)) {
            return (true);
        }
    }
</script>


</html>
